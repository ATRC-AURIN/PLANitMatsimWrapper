<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE config SYSTEM "http://www.matsim.org/files/dtd/config_v2.dtd">
<!-- Base configuration for car based simulation, with public transport included 
	as teleported mode -->
<config>
	<module name="controler">
		<param name="createGraphs" value="false" />
		<param name="dumpDataAtEnd" value="false" />
		<param name="mobsim" value="qsim" />
		<!-- do not delete directory because if output dir is overwritten where one does not have permission to remove it MATSim will crash -->
		<param name="overwriteFiles" value="overwriteExistingFiles" />
		<param name="writeEventsInterval" value="10" />
		<param name="writePlansInterval" value="10" />
		<param name="writeSnapshotsInterval" value="1" />
	</module>
	<module name="global">
		<param name="coordinateSystem" value="EPSG:4326" />
		<param name="numberOfThreads" value="4" />
	</module>
	<module name="linkStats">
		<param name="averageLinkStatsOverIterations" value="5" />
		<param name="writeLinkStatsInterval" value="10" />
	</module>
	<module name="planscalcroute">
		<param name="networkModes" value="car" />
		<!-- pt teletortation configuration: if the router encounters a leg with mode pt, it generates a “teleportation” route whose
         travel distance is the same as, and travel time is twice that of, a freespeed car route. This models public transit, assuming it travels along roughly the same routes as a car trip, but
         takes twice as long (cf. Reinhold, 2006)-->
    <parameterset type= "teleportedModeParameters" >
      <param name= "mode" value= "pt" />
      <!-- take on half the speed of car free speed instead as default-->
      <param name= "teleportedModeFreespeedFactor" value= "2.0" />
      <!-- no explicit absolute speed (m/s) set for pt legs as default-->
      <param name= "teleportedModeSpeed" value= "null"/>
      <!-- take on same distance as car as default-->
      <param name= "beelineDistanceFactor" value= "null"/>
    </parameterset>
    <!-- explicitly add walk due to MATSim wiping the defaults when one or more teleported modes is defined while it requires walk information for pt 
         see https://github.com/matsim-org/matsim-code-examples/issues/55-->
    <parameterset type= "teleportedModeParameters" >
      <param name= "mode" value= "walk" />
      <param name= "teleportedModeSpeed" value= "1.5"/>
      <param name= "beelineDistanceFactor" value= "null"/>
    </parameterset> 
	</module>
	<module name="qsim">
		<param name="linkDynamics" value="FIFO" />
		<param name="linkWidth" value="30.0" />
		<param name="mainMode" value="car" />
		<param name="numberOfThreads" value="4" />
		<param name="timeStepSize" value="00:00:01" />
		<param name="trafficDynamics" value="queue" />
		<param name="useLanes" value="false" />
		<param name="vehicleBehavior" value="teleport" />
		<param name="vehiclesSource" value="defaultVehicle" />
	</module>
	<module name="strategy">
		<parameterset type="strategysettings">
			<param name="strategyName" value="ReRoute" />
			<param name="weight" value="0.2" />
		</parameterset>
		<parameterset type="strategysettings">
			<param name="strategyName" value="TimeAllocationMutator" />
			<param name="weight" value="0.1" />
		</parameterset>
		<parameterset type="strategysettings">
			<param name="strategyName" value="SelectExpBeta" />
			<param name="weight" value="0.7" />
		</parameterset>
		<!-- multi-modal plans with support for mode choice is on the sub-tour level, i.e., it is expected
		that plans might have activities using various modes. Note that we must add the subtourmodechoice module accordingly -->
    <parameterset type="strategysettings">		
      <param name= "strategyName" value= "SubtourModeChoice" />
      <param name="weight" value="0.1" />
    </parameterset>		
	</module>
	<!-- add module so it is available for the subtourmode choice in strategy section. Explicitly name the available modes because if not it will adopt defaults for modes that are not supported
	and will crash -->
  <module name= "subtourModeChoice">
    <param name="behavior" value="fromSpecifiedModesToSpecifiedModes" />
    <param name="chainBasedModes" value="car" />
    <param name="considerCarAvailability" value="false" />
    <param name="modes" value="car,pt,walk" />  
  </module>	
	<module name="travelTimeCalculator">
		<param name="analyzedModes" value="car, pt" />
		<param name="calculateLinkToLinkTravelTimes" value="false" />
		<param name="calculateLinkTravelTimes" value="true" />
		<param name="maxTime" value="108000" />
		<param name="travelTimeAggregator" value="optimistic" />
		<param name="travelTimeBinSize" value="900" />
		<param name="travelTimeGetter" value="average" />
	</module>
  <!-- explicitly set the mode specific params, otherwise the defaults will be injected which contain modes unavailable
       in the simulation which causes the subtourmodechoice component to fail. Instead set explicitly supported modes using default values -->
  <module name="planCalcScore" >
    <parameterset type="scoringParameters" >
      <param name="earlyDeparture" value="-0.0" />
      <param name="lateArrival" value="-18.0" />
      <param name="marginalUtilityOfMoney" value="1.0" />
      <param name="performing" value="6.0" />
      <param name="subpopulation" value="null" />
      <param name="utilityOfLineSwitch" value="-1.0" />
      <param name="waiting" value="-0.0" />
      <param name="waitingPt" value="-6.0" />
    </parameterset>
      <parameterset type="modeParams" >
        <param name="mode" value="car" />
        <param name="constant" value="0.0" />
        <param name="dailyMonetaryConstant" value="0.0" />
        <param name="dailyUtilityConstant" value="0.0" />
        <param name="marginalUtilityOfDistance_util_m" value="0.0" />
        <param name="marginalUtilityOfTraveling_util_hr" value="-6.0" />
        <param name="monetaryDistanceRate" value="0.0" />
      </parameterset>
      <parameterset type="modeParams" >
        <param name="mode" value="pt" />
        <param name="constant" value="0.0" />
        <param name="dailyMonetaryConstant" value="0.0" />
        <param name="dailyUtilityConstant" value="0.0" />
        <param name="marginalUtilityOfDistance_util_m" value="0.0" />
        <param name="marginalUtilityOfTraveling_util_hr" value="-6.0" />
        <param name="monetaryDistanceRate" value="0.0" />
      </parameterset>
      <parameterset type="modeParams" >
        <param name="mode" value="walk" />
        <param name="constant" value="0.0" />
        <param name="dailyMonetaryConstant" value="0.0" />
        <param name="dailyUtilityConstant" value="0.0" />
        <param name="marginalUtilityOfDistance_util_m" value="0.0" />
        <param name="marginalUtilityOfTraveling_util_hr" value="-6.0" />
        <param name="monetaryDistanceRate" value="0.0" />
      </parameterset>
  </module> 	
</config>
